From fc2dbcbc04ff8ca5c9375f0734134ba90731efa8 Mon Sep 17 00:00:00 2001
From: "Daniel P. Berrange" <berrange@redhat.com>
Date: Fri, 16 Nov 2012 14:13:25 +0000
Subject: [PATCH] Add example script for querying KSM parameters

(cherry picked from commit acbcd60317c82b88924a60f06908841ae5580d86)
---
 examples/node-ksm.pl | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)
 create mode 100644 examples/node-ksm.pl

diff --git a/examples/node-ksm.pl b/examples/node-ksm.pl
new file mode 100644
index 0000000..ffbca19
--- /dev/null
+++ b/examples/node-ksm.pl
@@ -0,0 +1,24 @@
+#!/usr/bin/perl
+use warnings;
+use strict;
+use Sys::Virt;
+
+my $pagetoscan = shift @ARGV || 200;
+my $sleepmillis = shift @ARGV || 100;
+
+my $uri = "qemu:///system";
+my $con = Sys::Virt->new(address => $uri);
+
+my $params = $con->get_node_memory_parameters();
+foreach my $key (keys %{$params}) {
+    printf "%s: %d\n", $key, $params->{$key};
+}
+
+my %param = (Sys::Virt::NODE_MEMORY_SHARED_PAGES_TO_SCAN => $pagetoscan,
+	     Sys::Virt::NODE_MEMORY_SHARED_SLEEP_MILLISECS => $sleepmillis);
+$con->set_node_memory_parameters(\%param);
+
+$params = $con->get_node_memory_parameters();
+foreach my $key (keys %{$params}) {
+    printf "%s: %d\n", $key, $params->{$key};
+}
